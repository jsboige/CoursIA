version: '3.8'

services:
  forge-turbo:
    build: .
    image: forge-turbo:custom-numpy-fix
    container_name: forge-turbo
    hostname: forge-turbo
    ports:
      - "${FORGE_PORT:-17861}:17860"
      - "1111:1111"
    environment:
      - NVIDIA_VISIBLE_DEVICES=all
      - WEB_USER=${FORGE_USER:-admin}
      - WEB_PASSWORD=${FORGE_PASSWORD:-changeme}
      - FORGE_ARGS=--ui-settings-file config-turbo.json --api --api-log --listen --gradio-auth ${FORGE_USER:-admin}:${FORGE_PASSWORD:-changeme} --gpu-device-id 1 --xformers --skip-install
    volumes:
      - ../../shared/models:/opt/storage/stable_diffusion/models
      - ../../shared/outputs:/opt/storage/stable_diffusion/outputs
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    restart: unless-stopped