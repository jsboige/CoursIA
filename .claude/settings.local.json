{
  "permissions": {
    "allow": [
      "Bash(python:*)",
      "Bash(wsl.exe -d Ubuntu -- bash -c 'cat ~/.lean4-kernel-wrapper.py')",
      "Bash(where:*)",
      "Bash(wsl.exe -d Ubuntu -- bash -c:*)",
      "Bash(wsl.exe -d Ubuntu -- bash <<'EOF'\ncat > ~/.lean4-kernel-wrapper.py << 'PYTHON_EOF'\n#!/usr/bin/env python3\nimport sys\nimport subprocess\nimport os\nimport traceback\n\n# Fichier de log pour debug\nLOG_FILE = os.path.expanduser\\(\"~/.lean4-kernel.log\"\\)\n\ndef log\\(msg\\):\n    with open\\(LOG_FILE, \"a\"\\) as f:\n        f.write\\(f\"{msg}\\\\n\"\\)\n\ntry:\n    log\\(f\"=== Kernel starting ===\"\\)\n    log\\(f\"Arguments: {sys.argv}\"\\)\n    log\\(f\"CWD: {os.getcwd\\(\\)}\"\\)\n    \n    # Convertir le connection_file si c'est un chemin Windows\n    args = sys.argv[1:]\n    for i, arg in enumerate\\(args\\):\n        if arg == \"-f\" and i + 1 < len\\(args\\):\n            conn_file = args[i + 1]\n            log\\(f\"Original connection file: {conn_file}\"\\)\n            \n            # Si le chemin commence par ~, le remplacer par /mnt/c/Users/jsboi\n            if conn_file.startswith\\(\"~\"\\):\n                conn_file = conn_file.replace\\(\"~\", \"/mnt/c/Users/jsboi\", 1\\)\n                conn_file = conn_file.replace\\(\"\\\\\\\\\", \"/\"\\)\n                log\\(f\"Converted ~ path: {conn_file}\"\\)\n            \n            # Si chemin Windows \\(contient :\\), convertir avec wslpath\n            elif \":\" in conn_file and not conn_file.startswith\\(\"/\"\\):\n                result = subprocess.run\\([\"wslpath\", conn_file], capture_output=True, text=True\\)\n                if result.returncode == 0:\n                    conn_file = result.stdout.strip\\(\\)\n                    log\\(f\"Converted with wslpath: {conn_file}\"\\)\n            \n            args[i + 1] = conn_file\n            \n            # Vérifier que le fichier existe\n            if os.path.exists\\(conn_file\\):\n                log\\(f\"Connection file exists: YES\"\\)\n            else:\n                log\\(f\"Connection file exists: NO - this will cause kernel to fail!\"\\)\n            break\n    \n    # Ajouter .elan/bin au PATH\n    home = os.path.expanduser\\(\"~\"\\)\n    elan_bin = os.path.join\\(home, \".elan\", \"bin\"\\)\n    current_path = os.environ.get\\(\"PATH\", \"\"\\)\n    os.environ[\"PATH\"] = elan_bin + \":\" + current_path\n    log\\(f\"PATH updated with: {elan_bin}\"\\)\n    \n    # Vérifier les binaires\n    for binary in [\"lean\", \"lake\", \"repl\"]:\n        bin_path = os.path.join\\(elan_bin, binary\\)\n        if os.path.exists\\(bin_path\\):\n            log\\(f\"{binary}: found at {bin_path}\"\\)\n        else:\n            log\\(f\"{binary}: NOT FOUND!\"\\)\n    \n    # Changer dans le répertoire home\n    os.chdir\\(home\\)\n    log\\(f\"Changed to: {home}\"\\)\n    \n    # Lancer le kernel\n    python_bin = os.path.join\\(home, \".lean4-venv\", \"bin\", \"python3\"\\)\n    log\\(f\"Launching: {python_bin} -m lean4_jupyter.kernel {args}\"\\)\n    \n    os.execvp\\(python_bin, [python_bin, \"-m\", \"lean4_jupyter.kernel\"] + args\\)\n    \nexcept Exception as e:\n    log\\(f\"ERROR: {e}\"\\)\n    log\\(traceback.format_exc\\(\\)\\)\n    raise\nPYTHON_EOF\n\nchmod +x ~/.lean4-kernel-wrapper.py\necho \"Debug wrapper installed\"\n\n# Vider le log précédent\n> ~/.lean4-kernel.log\nEOF)",
      "Bash(wsl.exe -d Ubuntu -- bash <<'EOF'\ncat > ~/.lean4-kernel-launcher.sh << 'LAUNCHER_EOF'\n#!/bin/bash\n# Debug logging\nLOG_FILE=\"$HOME/.lean4-launcher.log\"\necho \"=== Launcher called ===\" >> \"$LOG_FILE\"\necho \"Args: $@\" >> \"$LOG_FILE\"\necho \"Arg1: $1\" >> \"$LOG_FILE\"\necho \"Arg count: $#\" >> \"$LOG_FILE\"\n\n# Le connection_file est passé comme argument\nCONNECTION_FILE=\"$1\"\necho \"CONNECTION_FILE: $CONNECTION_FILE\" >> \"$LOG_FILE\"\n\n# Exécuter le wrapper Python avec le connection file\nexec ~/.lean4-kernel-wrapper.py -f \"$CONNECTION_FILE\"\nLAUNCHER_EOF\n\nchmod +x ~/.lean4-kernel-launcher.sh\necho \"Debug launcher installed\"\n> ~/.lean4-launcher.log\nEOF)",
      "Bash(wsl.exe -d Ubuntu cat:*)",
      "Bash(powershell:*)"
    ]
  }
}
